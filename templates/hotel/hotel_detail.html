<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ hotel.name }} - Hotel Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/hotel_detail.css') }}">
</head>
<body class="hotel-detail">
    {% include 'navbar/navbar.html' %}

    <!-- Hotel Details Section -->
    <div class="container my-5">
        {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
        {% endif %}
        <div class="row">
            <div class="col-md-6">
                <img src="{{ hotel.image_url }}" class="img-fluid" alt="{{ hotel.name }}">
            </div>
            <div class="col-md-6">
                <h2>{{ hotel.name }}</h2>
                <p><strong>Star Rating:</strong> {{ hotel.star_rating }} â˜…</p>
                <p><strong>Average Rating:</strong> {{ hotel.average_rating }} / 5</p>
                <p><strong>Location:</strong> {{ hotel.location }}</p>
                <p><strong>Description:</strong> {{ hotel.description }}</p>
                <p><strong>Price per night:</strong> $<span id="price_per_night" data-price="{{ hotel.price_per_night }}">{{ hotel.price_per_night }}</span></p>
                <p><strong>Amenities:</strong> {{ hotel.amenities or 'None' }}</p>
                <p><strong>Total Rooms:</strong> {{ hotel.total_rooms }}</p>
                <form action="{{ url_for('book_hotel', hotel_id=hotel.hotel_id) }}" method="POST">
                    <div class="mb-3">
                        <label for="date_from" class="form-label">Check-in Date</label>
                        <input type="date" class="form-control" id="date_from" name="date_from" required>
                    </div>
                    <div class="mb-3">
                        <label for="date_to" class="form-label">Check-out Date</label>
                        <input type="date" class="form-control" id="date_to" name="date_to" required>
                    </div>
                    <div class="mb-3">
                        <label for="number_of_guests" class="form-label">Number of Guests</label>
                        <input type="number" class="form-control" id="number_of_guests" name="number_of_guests" min="1" value="1" required>
                    </div>
                    <div class="mb-3">
                        <p><strong>Total Price:</strong> <span id="total_price">$0</span></p>
                    </div>
                    <button type="submit" class="btn btn-primary">Book Now</button>
                </form>
            </div>
        </div>

        <!-- Reviews Section -->
        <div class="mt-5">
            <h3>Reviews</h3>
            {% if reviews %}
            <ul class="list-unstyled">
                {% for review in reviews %}
                <li class="media mb-4">
                    <div class="media-body">
                        <h5 class="mt-0 mb-1">{{ review.full_name }} (Rating: {{ review.rating }}/5)</h5>
                        <p>{{ review.content }}</p>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p>No reviews yet.</p>
            {% endif %}

            <!-- Add a Review Form -->
            {% if 'user_id' in session %}
            <h4>Write a Review</h4>
            <form action="{{ url_for('add_review', hotel_id=hotel.hotel_id) }}" method="POST">
                <div class="mb-3">
                    <label for="rating" class="form-label">Rating (1-5)</label>
                    <input type="number" class="form-control" id="rating" name="rating" min="1" max="5" value="5" required>
                </div>
                <div class="mb-3">
                    <textarea class="form-control" id="review" name="review" rows="4" placeholder="Write your review..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Submit Review</button>
            </form>
            {% else %}
            <p>Please <a href="{{ url_for('login') }}">login</a> to write a review.</p>
            {% endif %}
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('date_from').addEventListener('change', calculateTotalPrice);
        document.getElementById('date_to').addEventListener('change', calculateTotalPrice);

        function calculateTotalPrice() {
            const dateFrom = new Date(document.getElementById('date_from').value);
            const dateTo = new Date(document.getElementById('date_to').value);
            const pricePerNightElement = document.getElementById('price_per_night');
            const pricePerNight = parseFloat(pricePerNightElement.getAttribute('data-price')) || 0;
            const totalPriceElement = document.getElementById('total_price');

            if (dateFrom && dateTo && dateTo > dateFrom) {
                const timeDiff = dateTo - dateFrom;
                const days = timeDiff / (1000 * 60 * 60 * 24);
                const totalPrice = days * pricePerNight;
                totalPriceElement.textContent = `$${totalPrice.toFixed(2)}`;
            } else {
                totalPriceElement.textContent = '$0';
            }
        }
    </script>
</body>
</html>